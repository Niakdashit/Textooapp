<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - R√©ponse rapide pour d√©part de soci√©t√©</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .email-content {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .response-content {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>Test - R√©ponse rapide pour d√©part de soci√©t√©</h1>
    
    <div class="test-section">
        <h2>üìß Message re√ßu (simulation)</h2>
        <div class="email-content">
            <strong>De:</strong> rpa@prismamedia.com<br>
            <strong>√Ä:</strong> jonanzau@gmail.com<br>
            <strong>Objet:</strong> Documents de d√©part<br><br>
            
            <strong>Bonjour JONATHAN,</strong><br><br>
            
            Veuillez trouver ci-joint les documents li√©s √† votre d√©part de la soci√©t√©. Nous vous remercions de nous en accuser r√©ception.<br><br>
            
            Bien cordialement
        </div>
    </div>
    
    <div class="test-section">
        <h2>ü§ñ R√©ponse g√©n√©r√©e actuellement (PROBL√âMATIQUE)</h2>
        <div class="response-content" style="background: #f8d7da;">
            <strong>Bonjour,</strong><br><br>
            
            Je tenais √† vous remercier pour votre aide pr√©cieuse sur ce projet. Votre expertise a vraiment fait la diff√©rence et a contribu√© √† sa r√©ussite.<br><br>
            
            <strong>Cordialement,<br>NOM Pr√©nom</strong>
        </div>
        <p style="color: #dc3545;"><strong>‚ùå Probl√®me:</strong> Cette r√©ponse ne correspond pas du tout au contenu du message re√ßu. Elle parle d'un "projet" et d'"aide pr√©cieuse" alors que le message original parle de "documents de d√©part de soci√©t√©".</p>
    </div>
    
    <div class="test-section success">
        <h2>‚úÖ R√©ponse attendue (CORRIG√âE)</h2>
        <div class="response-content">
            <strong>Bonjour,</strong><br><br>
            
            Je vous remercie pour l'envoi des documents li√©s √† mon d√©part de la soci√©t√©. Je vous confirme bien r√©ception de ces documents.<br><br>
            
            <strong>Cordialement,<br>NOM Pr√©nom</strong>
        </div>
        <p style="color: #155724;"><strong>‚úÖ Solution:</strong> Cette r√©ponse correspond parfaitement au contenu du message re√ßu et confirme la r√©ception des documents de d√©part.</p>
    </div>
    
    <div class="test-section">
        <h2>üß™ Test de d√©tection automatique</h2>
        <button onclick="testMessageDetection()">Tester la d√©tection du message</button>
        <button onclick="testResponseGeneration()">Tester la g√©n√©ration de r√©ponse</button>
        <button onclick="clearConsole()">Effacer la console</button>
        
        <h3>Console de d√©bogage:</h3>
        <div id="console" class="console-output"></div>
    </div>
    
    <div class="test-section">
        <h2>üìã Analyse du probl√®me</h2>
        <h3>Probl√®mes identifi√©s:</h3>
        <ul>
            <li><strong>D√©tection insuffisante:</strong> La fonction de d√©tection ne reconna√Æt pas le contexte "documents de d√©part de soci√©t√©"</li>
            <li><strong>R√©ponse g√©n√©rique:</strong> Le syst√®me utilise une r√©ponse g√©n√©rique sur les "projets" au lieu d'une r√©ponse sp√©cifique</li>
            <li><strong>Manque de contexte:</strong> L'analyse du contenu ne prend pas en compte les mots-cl√©s sp√©cifiques comme "d√©part", "soci√©t√©", "accuser r√©ception"</li>
        </ul>
        
        <h3>Solutions impl√©ment√©es:</h3>
        <ul>
            <li><strong>Nouveaux modes de d√©tection:</strong> Ajout des modes "departure_documents", "administrative_documents", "documents_attached"</li>
            <li><strong>Analyse contextuelle am√©lior√©e:</strong> D√©tection sp√©cifique des mots-cl√©s li√©s aux documents administratifs</li>
            <li><strong>R√©ponses sp√©cifiques:</strong> R√©ponses adapt√©es au contexte exact du message re√ßu</li>
            <li><strong>Logging d√©taill√©:</strong> Ajout de logs pour diagnostiquer le processus de d√©tection</li>
        </ul>
    </div>

    <script>
        // Simulation du message re√ßu
        const originalMessage = `Bonjour JONATHAN,

Veuillez trouver ci-joint les documents li√©s √† votre d√©part de la soci√©t√©. Nous vous remercions de nous en accuser r√©ception.

Bien cordialement`;

        function log(message) {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            console.textContent += `[${timestamp}] ${message}\n`;
            console.scrollTop = console.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('console').textContent = '';
        }

        function testMessageDetection() {
            log('=== TEST DE D√âTECTION DU MESSAGE ===');
            log('Message original: ' + originalMessage);
            
            const lowerText = originalMessage.toLowerCase();
            log('Message en minuscules: ' + lowerText);
            
            // Test des mots-cl√©s
            const keywords = {
                'd√©part': lowerText.includes('d√©part'),
                'soci√©t√©': lowerText.includes('soci√©t√©'),
                'documents': lowerText.includes('documents'),
                'ci-joint': lowerText.includes('ci-joint'),
                'accuser r√©ception': lowerText.includes('accuser r√©ception') || lowerText.includes('accuser'),
                'attestation': lowerText.includes('attestation'),
                'certificat': lowerText.includes('certificat'),
                'bulletin': lowerText.includes('bulletin')
            };
            
            log('Mots-cl√©s d√©tect√©s:');
            for (const [key, value] of Object.entries(keywords)) {
                log(`  ${key}: ${value}`);
            }
            
            // D√©terminer le mode de r√©ponse
            let responseMode = 'reply';
            if (lowerText.includes('d√©part') && lowerText.includes('soci√©t√©')) {
                responseMode = 'departure_documents';
            } else if (lowerText.includes('attestation') || lowerText.includes('certificat') || lowerText.includes('bulletin')) {
                responseMode = 'administrative_documents';
            } else if (lowerText.includes('documents') && lowerText.includes('ci-joint')) {
                responseMode = 'documents_attached';
            }
            
            log('Mode de r√©ponse d√©tect√©: ' + responseMode);
            log('=== FIN DU TEST DE D√âTECTION ===');
        }

        function testResponseGeneration() {
            log('=== TEST DE G√âN√âRATION DE R√âPONSE ===');
            
            const lowerText = originalMessage.toLowerCase();
            let responseMode = 'reply';
            
            // D√©tection du mode
            if (lowerText.includes('d√©part') && lowerText.includes('soci√©t√©')) {
                responseMode = 'departure_documents';
            }
            
            log('Mode d√©tect√©: ' + responseMode);
            
            // G√©n√©ration de la r√©ponse
            let response = '';
            switch(responseMode) {
                case 'departure_documents':
                    if (lowerText.includes('accuser r√©ception') || lowerText.includes('accuser')) {
                        response = "Bonjour,\n\nJe vous remercie pour l'envoi des documents li√©s √† mon d√©part de la soci√©t√©. Je vous confirme bien r√©ception de ces documents.\n\nCordialement,\nNOM Pr√©nom";
                    } else {
                        response = "Bonjour,\n\nJe vous remercie pour l'envoi des documents li√©s √† mon d√©part de la soci√©t√©. Je vais les examiner attentivement.\n\nCordialement,\nNOM Pr√©nom";
                    }
                    break;
                default:
                    response = "Merci pour votre message.";
            }
            
            log('R√©ponse g√©n√©r√©e:');
            log(response);
            
            // V√©rification de la pertinence
            if (response.includes('d√©part') && response.includes('soci√©t√©')) {
                log('‚úÖ SUCCESS: La r√©ponse contient les mots-cl√©s pertinents');
            } else {
                log('‚ùå ERROR: La r√©ponse ne contient pas les mots-cl√©s pertinents');
            }
            
            if (response.includes('accuser r√©ception') || response.includes('r√©ception')) {
                log('‚úÖ SUCCESS: La r√©ponse confirme la r√©ception des documents');
            } else {
                log('‚ùå ERROR: La r√©ponse ne confirme pas la r√©ception des documents');
            }
            
            log('=== FIN DU TEST DE G√âN√âRATION ===');
        }

        // Test automatique au chargement
        window.addEventListener('load', function() {
            log('Page de test charg√©e');
            log('Message de test: ' + originalMessage.substring(0, 50) + '...');
        });
    </script>
</body>
</html>
